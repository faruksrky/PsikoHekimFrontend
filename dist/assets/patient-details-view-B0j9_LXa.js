import{u as S,au as O,r as m,C as B,a0 as K,p as x,j as e,g as T,T as t,A as $,h as y,d as g,z as k,B as c,F as p,Q as W}from"./index-CynfWJw_.js";import{C as H}from"./custom-breadcrumbs-D1SIBx8r.js";import{G as r}from"./Grid-DBuOJ6h1.js";import{C}from"./Card-CrNj0u9u.js";import{C as b}from"./Chip-BAdTIlY7.js";import{T as U}from"./TableContainer-D58wC3j_.js";import{a as Y,c as _,T as F,b as Q}from"./TableHead-Dv6mOM_3.js";import{T as d}from"./TableCell-DQfdyrWM.js";function se(){var w,I;const u=S(),{id:h}=O(),[s,z]=m.useState(null),[n,D]=m.useState([]),[N,v]=m.useState([]),[G,L]=m.useState(!0),[j,M]=m.useState(!1),P=m.useCallback(async()=>{try{L(!0);const a=sessionStorage.getItem("jwt_access_token"),i=await fetch(`${B.psikoHekimBaseUrl}/patient/${h}`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!i.ok)throw new Error("Failed to fetch patient details");const o=await i.json();o.createdAt||(o.createdAt="2024-01-10T10:30:00Z"),z(o);try{const l=await fetch(`${B.psikoHekimBaseUrl}/patient/${h}/payments`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(l.ok){const E=await l.json();D(E.payments||[])}else console.log("Payment API not available, using mock data"),D([{amount:3e3,paymentDate:"2024-01-15",status:"COMPLETED",description:"İlk seans ödemesi"},{amount:3e3,paymentDate:"2024-01-22",status:"COMPLETED",description:"İkinci seans ödemesi"},{amount:3e3,paymentDate:"2024-01-29",status:"PENDING",description:"Üçüncü seans ödemesi"},{amount:3e3,paymentDate:"2024-02-05",status:"COMPLETED",description:"Dördüncü seans ödemesi"},{amount:3e3,paymentDate:"2024-02-12",status:"COMPLETED",description:"Beşinci seans ödemesi"}])}catch(l){console.log("Payment data not available, using mock data:",l),D([{amount:3e3,paymentDate:"2024-01-15",status:"COMPLETED",description:"İlk seans ödemesi"},{amount:3e3,paymentDate:"2024-01-22",status:"COMPLETED",description:"İkinci seans ödemesi"},{amount:3e3,paymentDate:"2024-01-29",status:"PENDING",description:"Üçüncü seans ödemesi"},{amount:3e3,paymentDate:"2024-02-05",status:"COMPLETED",description:"Dördüncü seans ödemesi"},{amount:3e3,paymentDate:"2024-02-12",status:"COMPLETED",description:"Beşinci seans ödemesi"}])}try{const l=await fetch(`${B.psikoHekimBaseUrl}/patient/${h}/therapists`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(l.ok){const E=await l.json();v(E.therapists||[])}else console.log("Therapist API not available, using mock data"),v([{therapistFirstName:"Dr. Ahmet",therapistLastName:"Yılmaz"},{therapistFirstName:"Dr. Ayşe",therapistLastName:"Kaya"},{therapistFirstName:"Dr. Mehmet",therapistLastName:"Demir"}])}catch(l){console.log("Therapist data not available, using mock data:",l),v([{therapistFirstName:"Dr. Ahmet",therapistLastName:"Yılmaz"},{therapistFirstName:"Dr. Ayşe",therapistLastName:"Kaya"},{therapistFirstName:"Dr. Mehmet",therapistLastName:"Demir"}])}}catch(a){console.error("Error fetching patient details:",a),K.error("Danışan detayları yüklenirken hata oluştu"),u.push(x.dashboard.patient.list)}finally{L(!1)}},[h,u]);m.useEffect(()=>{P()},[P]);const R=()=>{u.push(x.dashboard.patient.edit(h))};if(G)return e.jsx(T,{maxWidth:"lg",children:e.jsx(t,{children:"Danışan detayları yükleniyor..."})});if(!s)return e.jsxs(T,{maxWidth:"lg",children:[e.jsx($,{severity:"error",sx:{mb:3},children:"Danışan bilgileri bulunamadı."}),e.jsx(y,{variant:"contained",startIcon:e.jsx(g,{icon:"eva:arrow-back-fill"}),onClick:()=>u.push(x.dashboard.patient.list),children:"Danışan Listesine Dön"})]});const A=n.reduce((a,i)=>a+(i.amount||0),0),f=a=>a?new Date(a).toLocaleDateString("tr-TR"):"Belirtilmemiş";return e.jsxs(T,{maxWidth:"lg",children:[e.jsx(H,{heading:"Danışan Detayları",links:[{name:"Dashboard",href:x.dashboard.root},{name:"Danışanlar",href:x.dashboard.patient.root},{name:"Detaylar"}],action:e.jsx(k,{direction:"row",spacing:2,children:e.jsx(y,{variant:"outlined",onClick:R,startIcon:e.jsx(g,{icon:"solar:pen-bold"}),children:"Düzenle"})}),sx:{mb:{xs:3,md:5}}}),e.jsxs(r,{container:!0,spacing:3,children:[e.jsxs(r,{item:!0,xs:12,md:4,children:[e.jsxs(C,{sx:{p:3,textAlign:"center"},children:[e.jsxs(t,{variant:"h4",sx:{bgcolor:"primary.main",color:"white",borderRadius:"50%",width:120,height:120,display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",mb:2},children:[(w=s.patientFirstName)==null?void 0:w[0],(I=s.patientLastName)==null?void 0:I[0]]}),e.jsxs(t,{variant:"h5",gutterBottom:!0,children:[s.patientFirstName," ",s.patientLastName]}),e.jsx(t,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Danışan"}),e.jsx(b,{label:s.patientGender==="ERKEK"?"Erkek":s.patientGender==="KADIN"?"Kadın":"Belirtilmemiş",color:"primary",sx:{mt:1}})]}),e.jsxs(C,{sx:{p:3,mt:3},children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Finansal Özet"}),e.jsxs(k,{spacing:2,children:[e.jsxs(c,{sx:{textAlign:"center",p:2,bgcolor:"success.lighter",borderRadius:1},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Toplam Ödeme"}),e.jsxs(t,{variant:"h4",color:"success.main",fontWeight:"bold",children:["₺",A.toLocaleString()]})]}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Ödeme Sayısı"}),e.jsx(t,{variant:"body1",fontWeight:"medium",children:n.length})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Ortalama"}),e.jsxs(t,{variant:"body1",fontWeight:"medium",children:["₺",n.length>0?Math.round(A/n.length).toLocaleString():0]})]})]}),e.jsx(p,{}),e.jsxs(c,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Kayıt Tarihi"}),e.jsx(t,{variant:"body1",children:f(s.createdAt)})]})]})]})]}),e.jsx(r,{item:!0,xs:12,md:8,children:e.jsxs(C,{sx:{p:3},children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Kişisel Bilgiler"}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"E-posta"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:s.patientEmail||"Belirtilmemiş"})]}),e.jsxs(r,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Telefon"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:s.patientPhoneNumber||"Belirtilmemiş"})]}),e.jsxs(r,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Yaş"}),e.jsxs(t,{variant:"body1",gutterBottom:!0,children:[s.patientAge," yaşında"]})]}),e.jsxs(r,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Cinsiyet"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:s.patientGender==="ERKEK"?"Erkek":s.patientGender==="KADIN"?"Kadın":"Belirtilmemiş"})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Adres"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:s.patientAddress||"Belirtilmemiş"})]})]}),e.jsx(p,{sx:{my:3}}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Adres Bilgileri"}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Ülke"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:s.patientCountry||"Belirtilmemiş"})]}),e.jsxs(r,{item:!0,xs:12,sm:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Şehir"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:s.patientCity||"Belirtilmemiş"})]})]}),s.patientReference&&e.jsxs(e.Fragment,{children:[e.jsx(p,{sx:{my:3}}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Diğer Bilgiler"}),e.jsx(r,{container:!0,spacing:2,children:e.jsxs(r,{item:!0,xs:12,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Referans"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:s.patientReference})]})})]}),N.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(p,{sx:{my:3}}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Çalıştığı Danışmanlar"}),e.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:3},children:N.map((a,i)=>e.jsx(b,{label:`${a.therapistFirstName} ${a.therapistLastName}`,variant:"outlined",color:"primary"},i))})]}),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(p,{sx:{my:3}}),e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(t,{variant:"h6",children:"Ödeme Geçmişi"}),e.jsxs(k,{direction:"row",spacing:1,children:[e.jsx(y,{variant:"outlined",size:"small",startIcon:e.jsx(g,{icon:j?"solar:eye-closed-bold":"solar:eye-bold"}),onClick:()=>M(!j),children:j?"Gizle":"Detaylar"}),e.jsx(y,{variant:"text",size:"small",startIcon:e.jsx(g,{icon:"solar:external-link-bold"}),onClick:()=>u.push(x.dashboard.patient.payments(h)),children:"Ayrı Sayfa"})]})]}),j?e.jsx(U,{component:W,variant:"outlined",children:e.jsxs(Y,{size:"small",children:[e.jsx(_,{children:e.jsxs(F,{children:[e.jsx(d,{children:e.jsx("strong",{children:"Tarih"})}),e.jsx(d,{align:"right",children:e.jsx("strong",{children:"Tutar"})}),e.jsx(d,{align:"center",children:e.jsx("strong",{children:"Durum"})}),e.jsx(d,{children:e.jsx("strong",{children:"Açıklama"})})]})}),e.jsx(Q,{children:n.map((a,i)=>{var o;return e.jsxs(F,{hover:!0,children:[e.jsx(d,{children:f(a.paymentDate)}),e.jsx(d,{align:"right",children:e.jsxs(t,{variant:"body1",fontWeight:"medium",children:["₺",(o=a.amount)==null?void 0:o.toLocaleString()]})}),e.jsx(d,{align:"center",children:e.jsx(b,{label:a.status==="PENDING"?"Beklemede":a.status==="COMPLETED"?"Tamamlandı":a.status==="FAILED"?"Başarısız":a.status||"Tamamlandı",color:a.status==="PENDING"?"warning":a.status==="COMPLETED"?"success":a.status==="FAILED"?"error":"success",size:"small"})}),e.jsx(d,{children:a.description||"Seans ödemesi"})]},i)})})]})}):e.jsxs(c,{children:[n.slice(0,3).map((a,i)=>{var o;return e.jsxs(c,{sx:{p:2,border:"1px solid",borderColor:"divider",borderRadius:1,mb:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(c,{children:[e.jsxs(t,{variant:"body1",fontWeight:"bold",children:["₺",(o=a.amount)==null?void 0:o.toLocaleString()]}),e.jsx(t,{variant:"body2",color:"text.secondary",children:f(a.paymentDate)})]}),e.jsx(b,{label:a.status==="PENDING"?"Beklemede":a.status==="COMPLETED"?"Tamamlandı":a.status==="FAILED"?"Başarısız":a.status||"Tamamlandı",color:a.status==="PENDING"?"warning":a.status==="COMPLETED"?"success":a.status==="FAILED"?"error":"success",size:"small"})]},i)}),n.length>3&&e.jsx(c,{sx:{textAlign:"center",mt:2},children:e.jsxs(t,{variant:"body2",color:"text.secondary",children:["+",n.length-3," ödeme daha..."]})})]})]})]})})]})]})}export{se as PatientDetailsView};
