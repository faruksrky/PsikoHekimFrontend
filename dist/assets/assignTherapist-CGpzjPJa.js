import{C as I,$ as q,au as A,i as M,av as U,aw as V,a as Y,r as c,j as e,g as x,T as g,p as D,z as _,I as J,d as K,a5 as X,h as Z,a0 as T,ax as ee,H as ae}from"./index-CynfWJw_.js";import{u as te}from"./index-CyqANO-S.js";import{a as se}from"./patient-BpbsSwDq.js";import{T as ne}from"./table-head-custom-CNCVwu1c.js";import{C as re}from"./custom-breadcrumbs-D1SIBx8r.js";import{C as ie}from"./Card-CrNj0u9u.js";import{T as oe}from"./KeyboardArrowRight-DAjf8yPQ.js";import{T as le}from"./TableContainer-D58wC3j_.js";import{a as me,b as ce,T as v}from"./TableHead-Dv6mOM_3.js";import{T as o}from"./TableCell-DQfdyrWM.js";import{T as de}from"./TablePagination-BQYB6LpS.js";import"./index-DZrydARe.js";import"./config-context-client-v7VOFo66-SrREZ7yf.js";import"./Checkbox-B5NrqAli.js";import"./Select-Cf1IhRw-.js";import"./isMuiElement-DgtO_rkw.js";function he(){const{data:n,error:b,isLoading:f,mutate:i}=te(I.therapistListUrl,async l=>{try{return(await q.get(l)).data}catch(m){throw console.error("Error fetching therapists:",m),m}},{revalidateOnFocus:!1,revalidateOnReconnect:!1,shouldRetryOnError:!1});return{therapists:(n==null?void 0:n.therapists)||[],isLoading:f,error:b,mutate:i}}function pe(){var S;const{id:n}=A(),b=M(),f=U(),i=V(),{user:l}=Y(),m=(S=f.state)==null?void 0:S.patient,[j,y]=c.useState(0),[d,k]=c.useState(5),[F,xe]=c.useState([]),[N,$]=c.useState(""),{therapists:h,isLoading:R,error:P,mutate:L}=he(),{patient:B,patientLoading:O,patientError:C}=se(n);if(c.useEffect(()=>{if(!n){console.error("Danışan ID bulunamadı!");return}(async()=>{try{await L()}catch(t){console.error("Danışman yükleme hatası:",t),T.error("Danışman listesi yüklenirken bir hata oluştu!")}})()},[n,L]),!n)return e.jsx(x,{maxWidth:i.themeStretch?!1:"xl",children:e.jsx(g,{color:"error",children:"Danışan ID bulunamadı!"})});if(R||O)return e.jsx(x,{maxWidth:i.themeStretch?!1:"xl",children:e.jsx(g,{children:"Yükleniyor..."})});if(P||C)return e.jsx(x,{maxWidth:i.themeStretch?!1:"xl",children:e.jsx(g,{color:"error",children:P?`Danışman listesi yüklenirken bir hata oluştu: ${P.message}`:C?`Danışan bilgileri yüklenirken bir hata oluştu: ${C.message}`:"Bilinmeyen bir hata oluştu"})});const W=(a,t)=>{y(t)},H=a=>{k(parseInt(a.target.value,10)),y(0)},z=a=>{$(a.target.value),y(0)},G=async a=>{try{const t=h.find(u=>u.therapistId===a);if(!t)throw new Error("Terapist bulunamadı");const r=m||B;if(!r)throw new Error("Danışan bilgileri bulunamadı");const p={messageName:"startTherapistAssignmentProcess",variables:{patientId:n,patientFirstName:r.patientFirstName,patientLastName:r.patientLastName,patientEmail:r.patientEmail,patientPhoneNumber:r.patientPhoneNumber,therapistId:t.therapistId,therapistFirstName:t.therapistFirstName,therapistLastName:t.therapistLastName,processName:"Danışan Atama İsteği",description:`${r.patientFirstName} ${r.patientLastName} isimli danışandan ${t.therapistFirstName} ${t.therapistLastName} için atama isteği gönderildi`,startedBy:(l==null?void 0:l.displayName)||"Sistem",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}};if(!(await ee.post(I.bpmn.endpoints.assignTherapist,p)).data)throw new Error("BPMN süreci başlatılamadı");T.success(`Danışman atama işlemi gerçekleştirildi. ${t.therapistFirstName} ${t.therapistLastName} isimli terapist onaya gönderildi.`),b(D.dashboard.inbox)}catch(t){console.error("Danışman atama hatası:",t),T.error(t.message||"Danışman atanırken bir hata oluştu!")}},s=h==null?void 0:h.filter(a=>{var r,p,w,u,E;const t=N.toLowerCase();return((r=a.therapistFirstName)==null?void 0:r.toLowerCase().includes(t))||((p=a.therapistLastName)==null?void 0:p.toLowerCase().includes(t))||((w=a.therapistEmail)==null?void 0:w.toLowerCase().includes(t))||((u=a.therapistPhoneNumber)==null?void 0:u.toLowerCase().includes(t))||((E=a.therapistType)==null?void 0:E.toLowerCase().includes(t))}),Q=[{id:"therapistId",label:"ID",align:"left"},{id:"fullName",label:"Ad Soyad",align:"left"},{id:"email",label:"E-posta",align:"left"},{id:"phone",label:"Telefon",align:"left"},{id:"therapistType",label:"Danışman Tipi",align:"left"},{id:"action",label:"İşlem",align:"center"}];return e.jsxs(x,{maxWidth:i.themeStretch?!1:"xl",children:[e.jsx(re,{heading:"Danışman Atama",links:[{name:"Dashboard",href:D.dashboard.root},{name:"Danışanlar",href:D.dashboard.patient.root},{name:"Danışman Atama"}],sx:{mb:{xs:3,md:5}}}),e.jsxs(ie,{children:[e.jsx(_,{spacing:2,direction:{xs:"column",sm:"row"},alignItems:{sm:"center"},justifyContent:"space-between",sx:{p:2.5},children:e.jsx(oe,{value:N,onChange:z,placeholder:"Danışman ara...",InputProps:{startAdornment:e.jsx(J,{position:"start",children:e.jsx(K,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},sx:{width:{xs:1,sm:260}}})}),e.jsx(le,{sx:{position:"relative",overflow:"unset"},children:e.jsx(X,{children:e.jsxs(me,{size:i.dense?"small":"medium",sx:{minWidth:800},children:[e.jsx(ne,{headLabel:Q,rowCount:s==null?void 0:s.length,numSelected:F.length}),e.jsx(ce,{children:(s==null?void 0:s.length)===0?e.jsx(v,{children:e.jsx(o,{colSpan:5,align:"center",children:e.jsx(g,{variant:"body2",color:"text.secondary",children:N?"Arama kriterlerine uygun danışman bulunamadı.":"Henüz danışman bulunmuyor."})})}):s==null?void 0:s.slice(j*d,j*d+d).map(a=>e.jsxs(v,{hover:!0,children:[e.jsx(o,{children:a.therapistId}),e.jsx(o,{children:`${a.therapistFirstName} ${a.therapistLastName}`}),e.jsx(o,{children:a.therapistEmail}),e.jsx(o,{children:a.therapistPhoneNumber}),e.jsx(o,{children:a.therapistType}),e.jsx(o,{align:"center",children:e.jsx(Z,{variant:"contained",color:"primary",onClick:()=>G(a.therapistId),children:"Ata"})})]},a.therapistId))})]})})}),e.jsx(de,{page:j,component:"div",count:(s==null?void 0:s.length)||0,rowsPerPage:d,onPageChange:W,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:H})]})]})}const ue={title:`Danışman Ata | Dashboard - ${I.appName}`};function Ae(){const{id:n}=A();return e.jsxs(e.Fragment,{children:[e.jsx(ae,{children:e.jsxs("title",{children:[" ",ue.title]})}),e.jsx(pe,{patientId:n})]})}export{Ae as default};
