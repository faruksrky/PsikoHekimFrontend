import{u as R,au as A,r as f,j as e,g as x,T as r,p as l,z as c,A as M,h as k,a0 as u,C as m}from"./index-CynfWJw_.js";import{o as I,c as W,d as G}from"./yup-2ah1IYR7.js";import{u as L,F as O}from"./fields-CkpNXIXJ.js";import{F as _}from"./form-provider-BboyyOkn.js";import{C as z}from"./custom-breadcrumbs-D1SIBx8r.js";import{C as H}from"./Card-CrNj0u9u.js";import"./KeyboardArrowRight-DAjf8yPQ.js";import"./Select-Cf1IhRw-.js";import"./isMuiElement-DgtO_rkw.js";import"./index-B5Fc--5R.js";import"./use-popover-BYoJAYR4.js";import"./styles-CjY7tkEK.js";import"./Chip-BAdTIlY7.js";import"./Checkbox-B5NrqAli.js";import"./DatePicker-D6Bg7nNj.js";import"./DialogContent-C7q4RNtx.js";import"./Tabs-BVcslzTo.js";const V=W().shape({newScheduledDate:G().required("Yeni tarih gereklidir").test("future-date","Tarih gelecekte olmalıdır",n=>n?n>new Date:!1)});function ce(){var j,D,w,b;const n=R(),{id:o}=A(),[t,T]=f.useState(null),[$,y]=f.useState(!0),p=L({resolver:I(V),defaultValues:{newScheduledDate:new Date(Date.now()+2*60*60*1e3)}});f.useEffect(()=>{(async()=>{if(!o){u.error("Seans ID bulunamadı"),n.push(l.dashboard.therapySession.list);return}try{y(!0);const i=sessionStorage.getItem("jwt_access_token"),a=await fetch(`${m.psikoHekimBaseUrl}${m.therapySession.details}/${o}`,{method:"GET",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});if(!a.ok)throw new Error(`Failed to fetch therapy session: ${a.status}`);const h=await a.json();T(h),h.scheduledDate&&p.setValue("newScheduledDate",new Date(h.scheduledDate))}catch(i){console.error("Error fetching therapy session:",i),u.error("Seans yüklenirken bir hata oluştu"),n.push(l.dashboard.therapySession.list)}finally{y(!1)}})()},[o,n,p]);const v=async S=>{try{if(t!=null&&t.scheduledDate){const d=new Date(t.scheduledDate),s=new Date(S.newScheduledDate);if(d.getTime()===s.getTime()){u.error("Yeni tarih mevcut tarihten farklı olmalıdır!");return}}const i=sessionStorage.getItem("jwt_access_token"),a=new Date(S.newScheduledDate),h=a.getFullYear(),C=String(a.getMonth()+1).padStart(2,"0"),Y=String(a.getDate()).padStart(2,"0"),F=String(a.getHours()).padStart(2,"0"),B=String(a.getMinutes()).padStart(2,"0"),E=String(a.getSeconds()).padStart(2,"0"),N=`${h}-${C}-${Y}T${F}:${B}:${E}`,g=await fetch(`${m.psikoHekimBaseUrl}${m.therapySession.reschedule}/${o}`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({newDate:N})});if(!g.ok){const d=await g.text();let s="Seans yeniden planlanamadı";try{d&&d.trim().startsWith("{")?s=JSON.parse(d).message||s:s=d||s}catch{s=d||g.statusText||s}throw new Error(s)}u.success("Seans başarıyla yeniden planlandı!"),n.push(l.dashboard.therapySession.details(o))}catch(i){console.error("Error rescheduling session:",i),u.error(`Seans yeniden planlanırken hata oluştu: ${i.message}`)}};return $?e.jsx(x,{maxWidth:"lg",children:e.jsx(r,{children:"Yükleniyor..."})}):t?e.jsxs(x,{maxWidth:"lg",children:[e.jsx(z,{heading:"Seans Yeniden Planla",links:[{name:"Dashboard",href:l.dashboard.root},{name:"Terapi Seansları",href:l.dashboard.therapySession.root},{name:"Seans Detayları",href:l.dashboard.therapySession.details(o)},{name:"Yeniden Planla"}],sx:{mb:{xs:3,md:5}}}),e.jsx(_,{methods:p,onSubmit:p.handleSubmit(v),children:e.jsx(H,{sx:{p:3},children:e.jsxs(c,{spacing:3,children:[e.jsx(M,{severity:"info",children:"Seans yeniden planlandıktan sonra danışan ve danışmana bildirim gönderilecektir."}),e.jsxs(c,{spacing:2,children:[e.jsx(r,{variant:"h6",children:"Mevcut Seans Bilgileri"}),e.jsxs(c,{spacing:1,children:[e.jsx(r,{variant:"subtitle2",children:"Danışan"}),e.jsxs(r,{variant:"body2",children:[(j=t.patient)==null?void 0:j.patientFirstName," ",(D=t.patient)==null?void 0:D.patientLastName]})]}),e.jsxs(c,{spacing:1,children:[e.jsx(r,{variant:"subtitle2",children:"Danışman"}),e.jsxs(r,{variant:"body2",children:[(w=t.therapist)==null?void 0:w.therapistFirstName," ",(b=t.therapist)==null?void 0:b.therapistLastName]})]}),e.jsxs(c,{spacing:1,children:[e.jsx(r,{variant:"subtitle2",children:"Mevcut Tarih"}),e.jsx(r,{variant:"body2",children:new Date(t.scheduledDate).toLocaleString("tr-TR")})]})]}),e.jsxs(c,{spacing:3,children:[e.jsx(O.MobileDateTimePicker,{name:"newScheduledDate",label:"Yeni Randevu Tarihi ve Saati",ampm:!1,slotProps:{textField:{placeholder:"GG/AA/YYYY SS:DD",fullWidth:!0},actionBar:{actions:["cancel","accept"]},toolbar:{title:"Tarih ve Saat Seçin"}}}),e.jsxs(c,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(k,{color:"inherit",variant:"outlined",onClick:()=>n.push(l.dashboard.therapySession.details(o)),children:"İptal"}),e.jsx(k,{type:"submit",variant:"contained",color:"warning",children:"Yeniden Planla"})]})]})]})})})]}):e.jsx(x,{maxWidth:"lg",children:e.jsx(r,{children:"Seans bulunamadı"})})}export{ce as TherapySessionRescheduleView,ce as default};
