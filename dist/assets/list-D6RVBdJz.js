import{an as T,r as o,j as e,W as x,a3 as C,b as K,u as X,a0 as k,p as g,a2 as Z,h as y,R as ee,d as f,at as te,C as L,z as ne,H as ae}from"./index-CynfWJw_.js";import{c as se}from"./fields-CkpNXIXJ.js";import{u as ie}from"./patient-BpbsSwDq.js";import{G as re}from"./patient-new-edit-form-DxsQV1xJ.js";import{E as A}from"./empty-content-0T_kuyRU.js";import{D as le}from"./DataGridContainer-BdHldlzz.js";import{C as oe}from"./confirm-dialog-CIzJmROj.js";import{C as de}from"./custom-breadcrumbs-D1SIBx8r.js";import{F as v,I as F,S as P,O as E}from"./Select-Cf1IhRw-.js";import{C as w}from"./Checkbox-B5NrqAli.js";import{s as ue,D as me,G as ce,a as he,b as pe,c as ge,d as fe,e as b}from"./change-case-D-aEBbxU.js";import{F as xe,a as N,c as z}from"./filters-result-BGyDO7Ng.js";import{C as S}from"./Chip-BAdTIlY7.js";import{C as Ce}from"./Card-CrNj0u9u.js";import{m as be}from"./config-context-client-v7VOFo66-SrREZ7yf.js";import"./KeyboardArrowRight-DAjf8yPQ.js";import"./index-B5Fc--5R.js";import"./use-popover-BYoJAYR4.js";import"./styles-CjY7tkEK.js";import"./DatePicker-D6Bg7nNj.js";import"./DialogContent-C7q4RNtx.js";import"./isMuiElement-DgtO_rkw.js";import"./Tabs-BVcslzTo.js";import"./index-CyqANO-S.js";import"./index-DZrydARe.js";import"./zod-C2F2f5go.js";import"./Snackbar-DRE7eJ0q.js";import"./Grid2-dUppYYIQ.js";import"./DialogTitle-DxWrXely.js";import"./reselect-Cb1M7eWQ.js";import"./FormControlLabel-BHbER4Wr.js";import"./TablePagination-BQYB6LpS.js";import"./TableCell-DQfdyrWM.js";function je({filters:t,options:u}){const l=T({patientGender:t.state.patientGender||[],assignmentStatus:t.state.assignmentStatus||[]}),c=o.useCallback(a=>{const{target:{value:m}}=a;l.setState({patientGender:typeof m=="string"?m.split(","):m})},[l]),s=o.useCallback(()=>{t.setState({patientGender:l.state.patientGender})},[t,l.state.patientGender]),i=o.useCallback(a=>{const{target:{value:m}}=a;l.setState({assignmentStatus:typeof m=="string"?m.split(","):m})},[l]),d=o.useCallback(()=>{t.setState({assignmentStatus:l.state.assignmentStatus})},[t,l.state.assignmentStatus]);return e.jsxs(e.Fragment,{children:[e.jsxs(v,{sx:{flexShrink:0,width:{xs:1,md:200},mr:2},children:[e.jsx(F,{htmlFor:"patient-filter-patientGender-select-label",children:"Cinsiyet"}),e.jsxs(P,{multiple:!0,value:l.state.patientGender,onChange:c,onClose:s,input:e.jsx(E,{label:"Cinsiyet: "}),renderValue:a=>a.map(m=>m).join(", "),inputProps:{id:"patient-filter-patientGender-select-label"},sx:{textTransform:"capitalize"},children:[u.patientGender.map(a=>e.jsxs(x,{value:a.value,children:[e.jsx(w,{disableRipple:!0,size:"small",checked:l.state.patientGender.includes(a.value)}),a.label]},a.value)),e.jsx(x,{onClick:s,sx:{justifyContent:"center",fontWeight:a=>a.typography.button,border:a=>`solid 1px ${C(a.vars.palette.grey["500Channel"],.16)}`,bgcolor:a=>C(a.vars.palette.grey["500Channel"],.08)},children:"Başvur"})]})]}),e.jsxs(v,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[e.jsx(F,{htmlFor:"patient-filter-assignmentStatus-select-label",children:"Danışman Atama Durumu"}),e.jsxs(P,{multiple:!0,value:l.state.assignmentStatus,onChange:i,onClose:d,input:e.jsx(E,{label:"Danışman Atama Durumu: "}),renderValue:a=>a.map(m=>m==="assigned"?"Atanmış":m==="unassigned"?"Atanmamış":m).join(", "),inputProps:{id:"patient-filter-assignmentStatus-select-label"},sx:{textTransform:"capitalize"},children:[e.jsxs(x,{value:"assigned",children:[e.jsx(w,{disableRipple:!0,size:"small",checked:l.state.assignmentStatus.includes("assigned")}),"Atanmış"]}),e.jsxs(x,{value:"unassigned",children:[e.jsx(w,{disableRipple:!0,size:"small",checked:l.state.assignmentStatus.includes("unassigned")}),"Atanmamış"]}),e.jsx(x,{onClick:d,sx:{justifyContent:"center",fontWeight:a=>a.typography.button,border:a=>`solid 1px ${C(a.vars.palette.grey["500Channel"],.16)}`,bgcolor:a=>C(a.vars.palette.grey["500Channel"],.08)},children:"Başvur"})]})]})]})}function we({filters:t,totalResults:u,sx:l}){const c=o.useCallback(i=>{const d=t.state.patientGender.filter(a=>a!==i);t.setState({patientGender:d})},[t]),s=o.useCallback(i=>{const d=t.state.assignmentStatus.filter(a=>a!==i);t.setState({assignmentStatus:d})},[t]);return e.jsxs(xe,{totalResults:u,onReset:t.onResetState,sx:l,children:[e.jsx(N,{label:"Cinsiyet:",isShow:!!t.state.patientGender.length,children:t.state.patientGender.map(i=>o.createElement(S,{...z,key:i,label:ue(i),onDelete:()=>c(i)}))}),e.jsx(N,{label:"Danışman Atama Durumu:",isShow:!!t.state.assignmentStatus.length,children:t.state.assignmentStatus.map(i=>o.createElement(S,{...z,key:i,label:i==="assigned"?"Atanmış":i==="unassigned"?"Atanmamış":i,onDelete:()=>s(i)}))})]})}function ye({params:t}){return t.row.id}function Se({params:t}){return`${t.row.patientFirstName} ${t.row.patientLastName}`}function Ge({params:t}){return t.row.patientPhoneNumber}function Re({params:t}){return t.row.patientEmail}function De({params:t}){return t.row.patientAddress}function Ie({params:t}){return t.row.patientAge}function ke({params:t}){return t.row.patientCountry}function Ae({params:t}){return t.row.patientCity}function ve({params:t}){return t.row.patientGender}function Fe({params:t}){return t.row.patientReference}function Pe({params:t}){const u=t.row.isAssigned;return e.jsx(S,{label:u?"Atanmış":"Atanmamış",color:u?"success":"warning",size:"small",variant:u?"filled":"outlined"})}function Ee(){const t=K(),u=X(),{patients:l,patientsLoading:c}=ie(),s=T({patientGender:[],patientCountry:[],assignmentStatus:[]}),[i,d]=o.useState([]),[a,m]=o.useState([]),[W,G]=o.useState(null),O=o.useRef();o.useEffect(()=>{const n=p=>{console.log("Patient list refresh event received:",p.detail),be(L.patientListUrl,void 0,{revalidate:!0})};return window.addEventListener("patientListRefresh",n),()=>{window.removeEventListener("patientListRefresh",n)}},[]),o.useEffect(()=>{if(!l||!l.length){d([]);return}if(console.log("Patient Data Debug:",l.map(r=>({id:r.patientId,name:`${r.patientFirstName} ${r.patientLastName}`,therapistId:r.therapistId,therapistIdType:typeof r.therapistId,allFields:Object.keys(r)}))),!s.state.patientGender.length&&!s.state.patientCountry.length&&!s.state.assignmentStatus.length){const r=l.map(h=>({...h,id:h.patientId,isAssigned:h.therapistId&&h.therapistId!==null&&h.therapistId!==void 0&&h.therapistId!==""&&h.therapistId!==0}));d(r);return}const n=s.state.patientGender.map(r=>r.trim().toLowerCase()),p=s.state.patientCountry.map(r=>r.trim().toLowerCase()),U=l.filter(r=>{const h=!s.state.patientGender.length||r.patientGender&&n.includes(r.patientGender.trim().toLowerCase()),q=!s.state.patientCountry.length||r.therapistRating&&p.includes(r.patientCountry.toString().toLowerCase()),J=!s.state.assignmentStatus.length||s.state.assignmentStatus.some(D=>{const I=r.therapistId&&r.therapistId!==null&&r.therapistId!==void 0&&r.therapistId!==""&&r.therapistId!==0;return D==="assigned"?I:D==="unassigned"?!I:!0});return h&&q&&J}).map(r=>({...r,id:r.patientId,isAssigned:r.therapistId&&r.therapistId!==null&&r.therapistId!==void 0&&r.therapistId!==""&&r.therapistId!==0}));d(U)},[l,s.state.patientGender,s.state.patientCountry,s.state.assignmentStatus]);const B=s.state.patientGender.length>0||s.state.patientCountry.length>0||s.state.assignmentStatus.length>0,j=ze({inputData:i,filters:s.state}),M=o.useCallback(n=>{const p=i.filter(R=>R.id!==n);k.success("Danışan başarıyla silindi!"),d(p)},[i]),$=o.useCallback(()=>{const n=i.filter(p=>!a.includes(p.id));k.success(`${a.length} danışan başarıyla silindi!`),d(n)},[a,i]),V=o.useCallback(n=>{u.push(g.dashboard.patient.edit(n))},[u]),H=o.useCallback(n=>{u.push(g.dashboard.patient.details(n))},[u]),Y=o.useCallback(n=>{n.isAssigned&&!window.confirm("Bu danışan zaten bir danışmana atanmış. Değiştirmek istediğinize emin misiniz?")||u.push(g.dashboard.patient.assignTherapist(n.id),{state:{patient:n}})},[u]),_=o.useCallback(()=>e.jsx(Ne,{filters:s,canReset:B,setFilterButtonEl:G,filteredResults:j.length,onOpenConfirmDeleteRows:t.onTrue}),[s.state,a]),Q=[{field:"patientId",headerName:"ID",width:40,renderCell:n=>e.jsx(ye,{params:n})},{field:"patientFirstName",headerName:"Ad-Soyad",flex:1,minWidth:140,renderCell:n=>e.jsx(Se,{params:n})},{field:"patientGender",headerName:"Cinsiyet",flex:2,minWidth:200,renderCell:n=>e.jsx(ve,{params:n})},{field:"patientAge",headerName:"Yaş",flex:1,minWidth:120,renderCell:n=>e.jsx(Ie,{params:n})},{field:"patientPhoneNumber",headerName:"Telefon",flex:1.5,minWidth:130,renderCell:n=>e.jsx(Ge,{params:n})},{field:"patientEmail",headerName:"Email",flex:1.2,minWidth:170,renderCell:n=>e.jsx(Re,{params:n})},{field:"patientCountry",headerName:"Ülke",flex:1.2,minWidth:150,renderCell:n=>e.jsx(ke,{params:n})},{field:"patientCity",headerName:"Şehir",flex:1,minWidth:150,renderCell:n=>e.jsx(Ae,{params:n})},{field:"patientAddress",headerName:"Adres",flex:2,minWidth:300,renderCell:n=>e.jsx(De,{params:n})},{field:"patientReference",headerName:"Referans",flex:1,minWidth:150,renderCell:n=>e.jsx(Fe,{params:n})},{field:"isAssigned",headerName:"Danışman Atama Durumu",flex:1,minWidth:180,renderCell:n=>e.jsx(Pe,{params:n})},{type:"actions",field:"actions",headerName:"Danışman Ata",align:"right",headerAlign:"right",width:120,sortable:!1,filterable:!1,disableColumnMenu:!0,getActions:n=>[e.jsx(b,{showInMenu:!0,icon:e.jsx(f,{icon:"solar:eye-bold"}),label:"Detayları Görüntüle",onClick:()=>H(n.row.id)}),e.jsx(b,{showInMenu:!0,icon:e.jsx(f,{icon:"solar:pen-bold"}),label:"Düzenle",onClick:()=>V(n.row.id)}),e.jsx(b,{showInMenu:!0,icon:e.jsx(f,{icon:"solar:user-plus-bold"}),label:"Danışman Ata",onClick:()=>Y(n.row)}),e.jsx(b,{showInMenu:!0,icon:e.jsx(f,{icon:"solar:trash-bin-trash-bold"}),label:"Sil",onClick:()=>{M(n.row.id)},sx:{color:"error.main"}})]}];return o.useEffect(()=>()=>{},[]),o.useEffect(()=>{const n=document.activeElement;n&&n.getAttribute("aria-hidden")==="true"&&n.blur()}),e.jsxs(e.Fragment,{children:[e.jsxs(Z,{maxWidth:"xl",sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(de,{heading:"Danışan Listesi",links:[{name:"Dashboard",href:g.dashboard.root},{name:"Danışan",href:g.dashboard.patient.root},{name:"Danışan Listesi"}],action:e.jsx(y,{component:ee,href:g.dashboard.patient.new,variant:"contained",startIcon:e.jsx(f,{icon:"mingcute:add-line"}),children:"Yeni Danışan"}),sx:{mb:{xs:3,md:5}}}),e.jsx(Ce,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:e.jsx(le,{height:600,className:"datagrid-container",children:e.jsx(me,{localeText:te.components.MuiDataGrid.defaultProps.localeText,rows:j.length?j:[],columns:Q,loading:c,pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:10}}},onRowSelectionModelChange:n=>m(n),slots:{toolbar:_,noRowsOverlay:()=>e.jsx(A,{title:"Henüz hiç hasta kaydı bulunmamaktadır",description:"Yeni hasta eklemek için 'Yeni Danışan' butonunu kullanabilirsiniz."}),noResultsOverlay:()=>e.jsx(A,{title:"Arama kriterlerinize uygun hasta bulunamadı",description:"Farklı arama terimleri deneyebilir veya filtreleri temizleyebilirsiniz."})},slotProps:{panel:{anchorEl:W},toolbar:{setFilterButtonEl:G}},ref:O,style:{height:"100%",minHeight:"400px",width:"100%"},sx:{height:"100% !important",minHeight:"400px !important",width:"100% !important"}})})})]}),e.jsx(oe,{open:t.value,onClose:t.onFalse,title:"Silme Onayı",content:e.jsxs(e.Fragment,{children:[e.jsxs("strong",{children:[" ",a.length," "]})," danışanı silmek istediğinizden emin misiniz?"]}),action:e.jsx(y,{variant:"contained",color:"error",onClick:()=>{$(),t.onFalse()},children:"Sil"})})]})}function Ne({filters:t,canReset:u,selectedRowIds:l=[],filteredResults:c,setFilterButtonEl:s,onOpenConfirmDeleteRows:i}){return e.jsxs(e.Fragment,{children:[e.jsxs(ce,{children:[e.jsx(je,{filters:t,options:{patientGender:re,patientCountry:se}}),e.jsx(he,{}),e.jsxs(ne,{spacing:1,flexGrow:1,direction:"row",alignItems:"center",justifyContent:"flex-end",children:[!!l.length&&e.jsxs(y,{size:"small",color:"error",startIcon:e.jsx(f,{icon:"solar:trash-bin-trash-bold"}),onClick:i,children:["Sil (",l.length,")"]}),e.jsx(pe,{}),e.jsx(ge,{ref:s}),e.jsx(fe,{})]})]}),u&&e.jsx(we,{filters:t,totalResults:c,sx:{p:2.5,pt:0}})]})}function ze({inputData:t,filters:u}){const{patientGender:l,assignmentStatus:c}=u;let s=t;if(Array.isArray(l)&&l.length>0){const i=l.map(d=>d.trim().toLowerCase());s=s.filter(d=>d.patientGender&&i.includes(d.patientGender.trim().toLowerCase()))}return Array.isArray(c)&&c.length>0&&(s=s.filter(i=>{const d=i.therapistId&&i.therapistId!==null&&i.therapistId!==void 0&&i.therapistId!==""&&i.therapistId!==0;return c.some(a=>a==="assigned"?d:a==="unassigned"?!d:!0)})),s}const Te={title:`Danışan Listesi | Dashboard - ${L.appName}`};function ft(){return e.jsxs(e.Fragment,{children:[e.jsx(ae,{children:e.jsx("title",{children:Te.title})}),e.jsx(Ee,{})]})}export{ft as default};
