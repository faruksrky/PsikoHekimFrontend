import{r as R,a8 as de}from"./index-CynfWJw_.js";import{s as Ie}from"./index-DZrydARe.js";import{a as Oe,b as Re,S as Ve,d as Le,i as Q,c as Ae,s as Ee,e as ge,f as ke,g as r,h as Ne,U as X,j as We,k as Fe,E as ce,l as be,u as Y,I as le,r as xe,n as fe,F as Ue,R as Me,M as Pe}from"./config-context-client-v7VOFo66-SrREZ7yf.js";const ye="$inf$",Se=Ae&&window.__SWR_DEVTOOLS_USE__,qe=Se?window.__SWR_DEVTOOLS_USE__:[],He=()=>{Se&&(window.__SWR_DEVTOOLS_REACT__=de)},je=t=>Q(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],ze=()=>Re(Le,R.useContext(Ve)),$e=t=>(l,i,u)=>t(l,i&&((..._)=>{const[T]=Ee(l),[,,,g]=ge.get(ke);if(T.startsWith(ye))return i(..._);const h=g[T];return r(h)?i(..._):(delete g[T],h)}),u),Ge=qe.concat($e),Be=t=>function(...i){const u=ze(),[m,_,T]=je(i),g=Oe(u,T);let h=t;const{use:I}=g,A=(I||[]).concat(Ge);for(let k=A.length;k--;)h=A[k](h);return h(m,_||g.fetcher||null,g)},Xe=(t,l,i)=>{const u=l[t]||(l[t]=[]);return u.push(i),()=>{const m=u.indexOf(i);m>=0&&(u[m]=u[u.length-1],u.pop())}};He();const J=de.use||(t=>{switch(t.status){case"pending":throw t;case"fulfilled":return t.value;case"rejected":throw t.reason;default:throw t.status="pending",t.then(l=>{t.status="fulfilled",t.value=l},l=>{t.status="rejected",t.reason=l}),t}}),K={dedupe:!0},Ye=(t,l,i)=>{const{cache:u,compare:m,suspense:_,fallbackData:T,revalidateOnMount:g,revalidateIfStale:h,refreshInterval:I,refreshWhenHidden:A,refreshWhenOffline:k,keepPreviousData:he}=i,[b,me,w,pe]=ge.get(u),[e,Z]=Ee(t),y=R.useRef(!1),N=R.useRef(!1),x=R.useRef(e),q=R.useRef(l),H=R.useRef(i),o=()=>H.current,j=()=>o().isVisible()&&o().isOnline(),[v,z,De,_e]=Ne(u,e),W=R.useRef({}).current,U=r(T)?r(i.fallback)?X:i.fallback[e]:T,ee=(s,n)=>{for(const f in W){const a=f;if(a==="data"){if(!m(s[a],n[a])&&(!r(s[a])||!m(P,n[a])))return!1}else if(n[a]!==s[a])return!1}return!0},te=R.useMemo(()=>{const s=!e||!l?!1:r(g)?o().isPaused()||_?!1:h!==!1:g,n=d=>{const p=Re(d);return delete p._k,s?{isValidating:!0,isLoading:!0,...p}:p},f=v(),a=_e(),S=n(f),L=f===a?S:n(a);let c=S;return[()=>{const d=n(v());return ee(d,c)?(c.data=d.data,c.isLoading=d.isLoading,c.isValidating=d.isValidating,c.error=d.error,c):(c=d,d)},()=>L]},[u,e]),O=Ie.useSyncExternalStore(R.useCallback(s=>De(e,(n,f)=>{ee(f,n)||s()}),[u,e]),te[0],te[1]),ne=!y.current,Te=b[e]&&b[e].length>0,V=O.data,C=r(V)?U&&We(U)?J(U):U:V,M=O.error,$=R.useRef(C),P=he?r(V)?r($.current)?C:$.current:V:C,se=Te&&!r(M)?!1:ne&&!r(g)?g:o().isPaused()?!1:_?r(C)?!1:h:r(C)||h,re=!!(e&&l&&ne&&se),we=r(O.isValidating)?re:O.isValidating,ve=r(O.isLoading)?re:O.isLoading,F=R.useCallback(async s=>{const n=q.current;if(!e||!n||N.current||o().isPaused())return!1;let f,a,S=!0;const L=s||{},c=!w[e]||!L.dedupe,d=()=>fe?!N.current&&e===x.current&&y.current:e===x.current,p={isValidating:!1,isLoading:!1},ie=()=>{z(p)},oe=()=>{const E=w[e];E&&E[1]===a&&delete w[e]},ue={isValidating:!0};r(v().data)&&(ue.isLoading=!0);try{if(c&&(z(ue),i.loadingTimeout&&r(v().data)&&setTimeout(()=>{S&&d()&&o().onLoadingSlow(e,i)},i.loadingTimeout),w[e]=[n(Z),Fe()]),[f,a]=w[e],f=await f,c&&setTimeout(oe,i.dedupingInterval),!w[e]||w[e][1]!==a)return c&&d()&&o().onDiscarded(e),!1;p.error=X;const E=me[e];if(!r(E)&&(a<=E[0]||a<=E[1]||E[1]===0))return ie(),c&&d()&&o().onDiscarded(e),!1;const D=v().data;p.data=m(D,f)?D:f,c&&d()&&o().onSuccess(f,e,i)}catch(E){oe();const D=o(),{shouldRetryOnError:G}=D;D.isPaused()||(p.error=E,c&&d()&&(D.onError(E,e,D),(G===!0||Q(G)&&G(E))&&(!o().revalidateOnFocus||!o().revalidateOnReconnect||j())&&D.onErrorRetry(E,e,D,Ce=>{const B=b[e];B&&B[0]&&B[0](ce,Ce)},{retryCount:(L.retryCount||0)+1,dedupe:!0})))}return S=!1,ie(),!0},[e,u]),ae=R.useCallback((...s)=>be(u,x.current,...s),[]);if(Y(()=>{q.current=l,H.current=i,r(V)||($.current=V)}),Y(()=>{if(!e)return;const s=F.bind(X,K);let n=0;o().revalidateOnFocus&&(n=Date.now()+o().focusThrottleInterval);const a=Xe(e,b,(S,L={})=>{if(S==Ue){const c=Date.now();o().revalidateOnFocus&&c>n&&j()&&(n=c+o().focusThrottleInterval,s())}else if(S==Me)o().revalidateOnReconnect&&j()&&s();else{if(S==Pe)return F();if(S==ce)return F(L)}});return N.current=!1,x.current=e,y.current=!0,z({_k:Z}),se&&(r(C)||le?s():xe(s)),()=>{N.current=!0,a()}},[e]),Y(()=>{let s;function n(){const a=Q(I)?I(v().data):I;a&&s!==-1&&(s=setTimeout(f,a))}function f(){!v().error&&(A||o().isVisible())&&(k||o().isOnline())?F(K).then(n):n()}return n(),()=>{s&&(clearTimeout(s),s=-1)}},[I,A,k,e]),R.useDebugValue(P),_&&r(C)&&e){if(!fe&&le)throw new Error("Fallback data is required when using Suspense in SSR.");q.current=l,H.current=i,N.current=!1;const s=pe[e];if(!r(s)){const n=ae(s);J(n)}if(r(M)){const n=F(K);r(P)||(n.status="fulfilled",n.value=!0),J(n)}else throw M}return{mutate:ae,get data(){return W.data=!0,P},get error(){return W.error=!0,M},get isValidating(){return W.isValidating=!0,we},get isLoading(){return W.isLoading=!0,ve}}},et=Be(Ye);export{et as u};
