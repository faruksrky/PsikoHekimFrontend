import{b as R,j as a,r as h,z as A,I as B,d as g,c as E,V as U,W as b,u as z,an as D,ap as H,a2 as O,p as C,h as W,R as $,ah as Y,N as _,B as P,a5 as G,aq as V,H as M,C as X}from"./index-CynfWJw_.js";import"./user-new-edit-form-hZRfr_VO.js";import{C as q}from"./confirm-dialog-CIzJmROj.js";import{C as J}from"./custom-breadcrumbs-D1SIBx8r.js";import{u as Q,r as Z,T as ee,e as ae,a as se,g as te}from"./table-empty-rows-DvZvC8iE.js";import{T as oe}from"./table-head-custom-CNCVwu1c.js";import{T as le,a as re}from"./table-pagination-custom-BVBIcCbj.js";import{u as I}from"./use-popover-BYoJAYR4.js";import"./styles-CjY7tkEK.js";import{T as ne,a as ie,b as ce}from"./TableHead-Dv6mOM_3.js";import{T as x}from"./TableCell-DQfdyrWM.js";import{C as de}from"./Checkbox-B5NrqAli.js";import{C as me}from"./custom-popover-C5IB86uS.js";import{F}from"./Select-Cf1IhRw-.js";import{T as w}from"./KeyboardArrowRight-DAjf8yPQ.js";import{F as he,a as S,c as k}from"./filters-result-BGyDO7Ng.js";import{C as N}from"./Chip-BAdTIlY7.js";import{C as ue}from"./Card-CrNj0u9u.js";import{T as pe,a as xe}from"./Tabs-BVcslzTo.js";import"./new-password-icon-WncjN8xq.js";import"./fields-CkpNXIXJ.js";import"./zod-C2F2f5go.js";import"./Snackbar-DRE7eJ0q.js";import"./form-provider-BboyyOkn.js";import"./Grid2-dUppYYIQ.js";import"./isMuiElement-DgtO_rkw.js";import"./Alert-BoZA29CH.js";import"./DialogTitle-DxWrXely.js";import"./DialogContent-C7q4RNtx.js";import"./empty-content-0T_kuyRU.js";import"./TablePagination-BQYB6LpS.js";import"./FormControlLabel-BHbER4Wr.js";import"./index-B5Fc--5R.js";import"./DatePicker-D6Bg7nNj.js";function ge({row:e,selected:t,onSelectRow:c}){return R(),I(),a.jsx(a.Fragment,{children:a.jsxs(ne,{hover:!0,selected:t,"aria-checked":t,tabIndex:-1,children:[a.jsx(x,{padding:"checkbox",children:a.jsx(de,{id:String(e.id),checked:t,onClick:c})}),a.jsx(x,{sx:{whiteSpace:"nowrap"},children:e.id}),a.jsx(x,{sx:{whiteSpace:"nowrap"},children:e.firstName}),a.jsx(x,{sx:{whiteSpace:"nowrap"},children:e.lastName}),a.jsx(x,{sx:{whiteSpace:"nowrap"},children:e.email}),a.jsx(x,{sx:{whiteSpace:"nowrap"},children:e.userName})]})})}function fe({filters:e,options:t,onResetPage:c}){const n=I(),d=h.useCallback(l=>{c(),e.setState({lastName:l.target.value})},[e,c]),i=h.useCallback(l=>{c(),e.setState({firstName:l.target.value})},[e,c]);return a.jsxs(a.Fragment,{children:[a.jsxs(A,{spacing:2,alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:[a.jsx(F,{sx:{flexShrink:0,width:{xs:1,md:200}},children:a.jsx(w,{fullWidth:!0,label:"Adı",value:e.state.firstName,onChange:i})}),a.jsx(F,{sx:{flexShrink:0,width:{xs:1,md:200}},children:a.jsx(w,{fullWidth:!0,label:"Soyadı",value:e.state.lastName,onChange:d})}),a.jsxs(A,{direction:"row",alignItems:"center",spacing:2,flexGrow:1,sx:{width:1},children:[a.jsx(w,{fullWidth:!0,value:e.state.name,onChange:i,placeholder:"Ara...",InputProps:{startAdornment:a.jsx(B,{position:"start",children:a.jsx(g,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),a.jsx(E,{onClick:n.onOpen,children:a.jsx(g,{icon:"eva:more-vertical-fill"})})]})]}),a.jsx(me,{open:n.open,anchorEl:n.anchorEl,onClose:n.onClose,slotProps:{arrow:{placement:"right-top"}},children:a.jsxs(U,{children:[a.jsxs(b,{onClick:()=>{n.onClose()},children:[a.jsx(g,{icon:"solar:printer-minimalistic-bold"}),"Print"]}),a.jsxs(b,{onClick:()=>{n.onClose()},children:[a.jsx(g,{icon:"solar:import-bold"}),"Import"]}),a.jsxs(b,{onClick:()=>{n.onClose()},children:[a.jsx(g,{icon:"solar:export-bold"}),"Export"]})]})})]})}function je({filters:e,onResetPage:t,totalResults:c,sx:n}){const d=h.useCallback(()=>{t(),e.setState({firstName:""})},[e,t]),i=h.useCallback(()=>{t(),e.setState({lastName:""})},[e,t]),l=h.useCallback(()=>{t(),e.setState({status:"all"})},[e,t]),o=h.useCallback(()=>{t(),e.onResetState()},[e,t]);return a.jsxs(he,{totalResults:c,onReset:o,sx:n,children:[a.jsx(S,{label:"Servis Tamamlanma Durumu:",isShow:e.state.status!=="all",children:a.jsx(N,{...k,label:e.state.status,onDelete:l,sx:{textTransform:"capitalize"}})}),a.jsx(S,{label:"Adı:",isShow:!!e.state.firstName,children:a.jsx(N,{...k,label:e.state.firstName,onDelete:d})}),a.jsx(S,{label:"Soyadı:",isShow:!!e.state.lastName,children:a.jsx(N,{...k,label:e.state.lastName,onDelete:i})})]})}const be=[{value:"all",label:"Liste"}],Ce=[{id:"id",label:"ID"},{id:"firstName",label:"Ad"},{id:"lastName",label:"Soyad"},{id:"email",label:"Email"},{id:"userName",label:"Kullanıcı Adı"}];function we(){const e=Q();z();const t=R(),[c,n]=h.useState(!0),[d,i]=h.useState([]),l=D({firstName:"",lastName:"",status:"all"}),o=sessionStorage.getItem(H);h.useEffect(()=>{o&&(async()=>{var m,v;try{n(!0);const u="http://localhost:6700/users/list";console.log("Fetching users from Keycloak Auth Service:",u);const j=await V.get(u,{headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});if(Array.isArray(j.data)){const y=j.data.map((p,T)=>({id:p.id||`user-${T}`,firstName:p.firstName||"",lastName:p.lastName||"",email:p.email||"",userName:p.username||p.email||`user-${T}`}));i(y),console.log("Keycloak users loaded:",y.length)}else console.warn("Unexpected Keycloak response format:",j.data),i([])}catch(u){console.error("Error fetching Keycloak users:",u),((m=u.response)==null?void 0:m.status)===401?(console.log("Unauthorized access to Keycloak Admin API"),i([])):((v=u.response)==null?void 0:v.status)===404?(console.log("Keycloak realm not found"),i([])):(console.log("Keycloak API error, using fallback"),i([]))}finally{n(!1)}})()},[o]);const r=Se({inputData:d,comparator:te(e.order,e.orderBy),filters:l.state});Z(r,e.page,e.rowsPerPage);const f=!!l.state.firstName||l.state.lastName,K=!r.length&&f||!r.length,L=(s,m)=>{" "};return a.jsxs(a.Fragment,{children:[a.jsxs(O,{children:[a.jsx(J,{heading:"Kullanıcı Listesi",links:[{name:"Dashboard",href:C.dashboard.root},{name:"Kullanıcı",href:C.dashboard.user.root},{name:"Kullanıcı Listesi"}],action:a.jsx(W,{component:$,href:C.dashboard.user.new,variant:"contained",startIcon:a.jsx(g,{icon:"mingcute:add-line"}),children:"Yeni Kullanıcı"}),sx:{mb:{xs:3,md:5}}}),a.jsxs(ue,{sx:{width:"100%",overflowX:"auto",minHeight:"600px"},children:[a.jsx(pe,{value:l.state.status,onChange:L,sx:{px:2.5,boxShadow:s=>`inset 0 -2px 0 0 ${Y(s.vars.palette.grey["500Channel"],.08)}`},children:be.map(s=>a.jsx(xe,{iconPosition:"end",value:s.value,label:s.label,icon:a.jsx(_,{variant:(s.value==="all"||s.value===l.state.status)&&"filled"||"soft",children:["active","pending","banned","rejected"].includes(s.value)?d.filter(m=>m.status===s.value).length:d.length})},s.value))}),a.jsx(fe,{filters:l,onResetPage:e.onResetPage}),f&&a.jsx(je,{filters:l,totalResults:r.length,onResetPage:e.onResetPage,sx:{p:2.5,pt:0}}),a.jsxs(P,{sx:{position:"relative"},children:[a.jsx(le,{dense:e.dense,numSelected:e.selected.length,rowCount:r.length,onSelectAllRows:s=>e.onSelectAllRows(s,r.map(m=>m.id))}),a.jsx(P,{sx:{position:"relative",height:"500px",display:"flex",justifyContent:"flex-start",width:"100%",overflowX:"auto"},children:a.jsx(G,{children:a.jsxs(ie,{size:e.dense?"small":"medium",sx:{minWidth:1500,width:"100%"},children:[a.jsx(oe,{order:e.order,orderBy:e.orderBy,headLabel:Ce,rowCount:r.length,numSelected:e.selected.length,onSort:e.onSort,onSelectAllRows:s=>e.onSelectAllRows(s,r.map(m=>m.id))}),a.jsxs(ce,{children:[r.slice(e.page*e.rowsPerPage,e.page*e.rowsPerPage+e.rowsPerPage).map(s=>a.jsx(ge,{row:s,selected:e.selected.includes(s.id),onSelectRow:()=>e.onSelectRow(s.id)},s.id)),a.jsx(ee,{height:e.dense?56:76,emptyRows:ae(e.page,e.rowsPerPage,r.length)}),a.jsx(se,{notFound:K,title:"Henüz hiç kullanıcı kaydı bulunmamaktadır",description:"Yeni kullanıcı eklemek için 'Yeni Kullanıcı' butonunu kullanabilirsiniz."})]})]})})})]}),a.jsx(re,{page:e.page,dense:e.dense,count:r.length,rowsPerPage:e.rowsPerPage,onPageChange:e.onChangePage,onChangeDense:e.onChangeDense,onRowsPerPageChange:e.onChangeRowsPerPage})]})]}),a.jsx(q,{open:t.value,onClose:t.onFalse})]})}function Se({inputData:e,comparator:t,filters:c}){const{firstName:n,lastName:d,status:i}=c;if(!Array.isArray(e))return console.error("inputData is not an array:",e),[];const l=e.map((o,r)=>[o,r]);return l.sort((o,r)=>{const f=t(o[0],r[0]);return f!==0?f:o[1]-r[1]}),e=l.map(o=>o[0]),n&&(e=e.filter(o=>o.firstName.toLowerCase().includes(n.toLowerCase()))),d&&(e=e.filter(o=>o.lastName.toLowerCase().includes(d.toLowerCase()))),i!=="all"&&(e=e.filter(o=>o.status===i)),e}const ke={title:`Kullanıcı Listesi | Dashboard - ${X.appName}`};function oa(){return a.jsxs(a.Fragment,{children:[a.jsx(M,{children:a.jsx("title",{children:ke.title})}),a.jsx(we,{})]})}export{oa as default};
